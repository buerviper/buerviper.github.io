<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> How to write a Mastodon bot that posts random images in Python | Mathias Micheel | Researcher </title> <meta name="author" content="Mathias Micheel"> <meta name="description" content="Instructions for dummies from a dummy."> <meta name="keywords" content="photochemistry, photocatalysis, spectroscopy, nanoparticles, research, science, chemistry"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%98%80%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://buerviper.github.io/blog/2024/writing-a-mastodon-bot-in-python/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> </head> <body> <d-front-matter> <script async type="text/json">
      {
            "title": "How to write a Mastodon bot that posts random images in Python",
            "description": "Instructions for dummies from a dummy.",
            "published": "July 08, 2024",
            "authors": [
              
              {
                "author": "Mathias Micheel",
                "authorURL": "",
                "affiliations": [
                  {
                    "name": "",
                    "url": ""
                  }
                ]
              }
              
            ],
            "katex": {
              "delimiters": [
                {
                  "left": "$",
                  "right": "$",
                  "display": false
                },
                {
                  "left": "$$",
                  "right": "$$",
                  "display": true
                }
              ]
            }
          }
    </script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Mathias Micheel | Researcher </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>How to write a Mastodon bot that posts random images in Python</h1> <p>Instructions for dummies from a dummy.</p> </d-title> <d-byline></d-byline> <d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div> <a href="#"></a> </div> </nav> </d-contents> <p>As some of you might know, I am a big Suikoden fan. What’s Suikoden you ask? A great JRPG series created from Konami back in 1995 for the first PlayStation. Each game stars 108 (more or less) playable characters and the story revolves around political intrigues and personal conflicts. Overall, it’s a great series which hasn’t seen a new entry since 2012, but will see the first two games remastered for current consoles soon.</p> <p>Not only do I run the oldest and largest (because it’s by now the only) German Suikoden fanpage <a href="https://www.suikoversum.de" rel="external nofollow noopener" target="_blank">suikoversum.de</a>, but I’ve also been involved with the Suikoden Revival Movement, a fan movement I started with several other dedicated individuals back in 2011 to campaign for rereleases of older games, see new merch etc. Altogether, the fandom is great, and one of the finest works in the fandom next to the dozens of highly talented fanartists was the <a href="https://twitter.com/nocontextgensui" rel="external nofollow noopener" target="_blank">No Context Suikoden</a> Twitter account, which posted random bits of dialogue from the games which were mostly very silly in nature.</p> <p>Now, with Twitter becoming a digital hell and my move to the Fediverse, I wanted to bring such an account also over to Mastodon (after having asked the person who ran the account if it was ok to repost images). I thought this would be easy - I mean, there are dozens of bots on Mastodon that post random cat pictures every hour, so how hard can it be?</p> <p>Well, pretty hard for someone as tech savy as me. I think the most complex piece of code I’ve ever written was to change the name of every file in a directory by adding a terminal e, and even that takes me hours to write. So naturally, I was looking for good tutorials on the matter which I could simply copy&amp;paste, but I just couldn’t find one that fitted my needs. After a couple of hours, I managed to get the bot running, and I’m so proud that I wanted to share my knowledge here in a short tutorial so if you’re also interested in writing a bot, this might help you in getting started! I try to be very detailed - possibly too detailed - in a lot of steps, but if you are a programming beginner like me, I hope you appreciate the effort.</p> <p><strong>Disclaimer</strong> As I said, I am no coding expert. The code I’m showing here works, but at what cost? Well, I have no idea, but I would greatly appreciate if people with more expertise in coding (with Python) would give feedback on the code to improve it. Also, for me, it’s mostly an educational experience, so I want to learn something, so any feedback is appreciated! You can post it directly as a comment under this post if you have a github account or contact me over at Mastodon.</p> <h1 id="introduction">introduction</h1> <h2 id="sources-of-inspiration">sources of inspiration</h2> <p>As mentioned earlier, I looked for tutorials, but didn’t find any that wanted to do exactly what I do and/or were so elusive that I couldn’t follow them. I still consider it good practice to link to them, since they might be useful to you:</p> <ul> <li><a href="https://shkspr.mobi/blog/2018/08/easy-guide-to-building-mastodon-bots/" rel="external nofollow noopener" target="_blank">Easy guide to building Mastodon bots</a></li> <li><a href="https://blog.tiagorangel.com/creating-a-mastodon-bot-with-python" rel="external nofollow noopener" target="_blank">Creating a Mastodon Bot with Python</a></li> <li><a href="https://stefanbohacek.com/blog/using-mastodon-bots-for-data-visualization/" rel="external nofollow noopener" target="_blank">Using Mastodon bots for data visualization</a></li> <li><a href="https://botwiki.org/resource/tutorial/making-a-mastodon-bot-that-posts-random-images/" rel="external nofollow noopener" target="_blank">Making a Mastodon bot that posts random images</a></li> <li><a href="https://www.ayush.nz/2018/09/tweet-toot-building-a-bot-for-mastodon-using-python" rel="external nofollow noopener" target="_blank">Tweet-Toot: Building a bot for Mastodon using Python</a></li> </ul> <p>Going through each of these was very educational, since it helped me understanding where my understanding was still lacking! If you have found other tutorials, please share them!</p> <h1 id="prerequisites">prerequisites</h1> <p>To use this guide, you should fulfill the following conditions:</p> <ul> <li>Github account - we will use github to store our data and use github actions to activate the bot at selected intervals.</li> <li>Python - this program is not complicated, but in order to troubleshoot, it is definitely advisable to know some Python or programming basics!</li> <li>A Mastodon account - if you want to create a generic bot, https://botsin.space/ is probably the best server, as it is solely dedicated to bot accounts. If you want to set it up on a different server, make sure it is allowed; many servers don’t want random bots that post pictures of french fries every 10 minutes as it puts a lot of stress on their server.</li> </ul> <p>And that’s essentially it! All of the above is free, but you can of course use different websites and programs to start a bot. I’m not even sure my approach applies with the github ToS … but that’s a problem for another day.</p> <h2 id="goal">goal</h2> <p>First, we need to define what our bot should do in the end. I sketched the workflow as follows:</p> <ul> <li>The bot should post once at defined timepoints (e.g., once a day at a set time).</li> <li>The post consists of 1-4 pictures and a text section.</li> <li>Each picture should have alt text.</li> <li>Since some pictures depict violence/blood or have sexual overtones, so I’d like to be able turn on content warnings and/or toggle visibility of images if needed.</li> </ul> <p>All of this should be automated and my only job is the selection of images and generation of status text and alt text. I don’t want to do anything manually afterwards at all!</p> <p>Even though I talk about <em>a</em> bot, the entire thing is actually divided in two parts:</p> <ol> <li>The Python program which selects an image and generates the post. This could also be triggered manually.</li> <li>Something which automatically triggers the Python program in set intervals.</li> </ol> <p>This guide will help you set up both. Let’s go!</p> <h1 id="setting-up-mastodonpy">setting up mastodon.py</h1> <p>We will use the fantastic <a href="https://mastodonpy.readthedocs.io/en/stable/index.html" rel="external nofollow noopener" target="_blank">mastodon.py</a> package which will streamline a lot of the process of our small program. However, it also takes a bit of time to get used to, so we let’s say “Hello!” to our new friend.</p> <h2 id="registering-your-app-and-preparing-your-profile">registering your app and preparing your profile</h2> <p>If your app should communicate with your Mastodon account, you first need to register the app. While this can be done also using mastodon.py, I think it’s easier to just do it manually. If you want to start 100 bots, doing it automatically is probably a big time saver.</p> <p>Log into your Mastodon bot account and go to Settings &gt; Development and click on <em>new application</em>. Give your application a name (it doesn’t matter, but it will be visible later on the Mastodon interface, so chose something neutral like “Autoposter”) and ignore the website field. Here, you select the permissions of your bot. Since the bot I envision only posts text and photo posts, the only permissions I need are</p> <ul> <li> <strong>write:media</strong>, which will allow the bot to upload photos, and</li> <li> <strong>write:statuses</strong>, which will allow the bot to post.</li> </ul> <p>I deselect every other option. Of course, if you want a more elaborate bot that automatically favourites certain posts or should be a bit interactive, you’ll need to select these permissions. I won’t cover any of that here, though. You can also change the permissions (but not the name of the bot) afterwards if you need to.</p> <p>After you submitted your application, you find it listed in the Development tab. Click on it and you see a bunch of parameters on top. <strong>Don’t share your client key, secret, or access token with anybody.</strong> With these, anyone could access your bot and do all kind of things. We will need them later for our bot.</p> <p>You’re already finished, but it is good practice to mark your account as a bot account. To do so, you find a checkbox under Settings &gt; Profile. Checking it will put a small “bot” icon next to your account name.</p> <h2 id="writing-a-hello-world-post">writing a “Hello World!” post</h2> <p>Now we are ready to write our first small program. As a test, we will send a small “Hello world!” message to our profile, because … well, why not. So create a file called <code class="language-plaintext highlighter-rouge">run.py</code> (or be more creative than me) and start editing it.</p> <p>We’ll need to first import the Mastodon module:</p> <p><code class="language-plaintext highlighter-rouge">from mastodon import Mastodon</code></p> <p>This allows us to use all the nice <code class="language-plaintext highlighter-rouge">mastodon.py</code> functions! And we will directy start with one, which is probably the most important one, as it tells our program where to find our bot and that it is authenticated:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Setting up Mastodon
mastodon = Mastodon(
  access_token='[ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789]', # this is your access token from the Development tab from the step before
  api_base_url='botsin.space' # this is the URL of your bot's server
)'
</code></pre></div></div> <p>As I said earlier, the access token is very sensitive information. If you plan on making your bot somehow public, you shouldn’t put it in the file as we did now. We will address this later in more detail and how to avoid it!</p> <p>Finally, we write our small post using the <code class="language-plaintext highlighter-rouge">Mastodon.status_post</code> function (more details on the function can be found <a href="https://mastodonpy.readthedocs.io/en/stable/05_statuses.html#writing" rel="external nofollow noopener" target="_blank">here</a>). We can use this function and use lots of attributes. The full function looks like this:</p> <p><code class="language-plaintext highlighter-rouge">Mastodon.status_post(status, in_reply_to_id=None, media_ids=None, sensitive=False, visibility=None, spoiler_text=None, language=None, idempotency_key=None, content_type=None, scheduled_at=None, poll=None, quote_id=None)</code>`</p> <p>And the attributes we’ll need are:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">status</code> - is the text of the posts</li> <li> <code class="language-plaintext highlighter-rouge">media_ids</code> - will be used later for our photo positions</li> <li> <code class="language-plaintext highlighter-rouge">sensitive</code> - whether the photos will be marked as sensitive or note</li> <li> <code class="language-plaintext highlighter-rouge">spoiler_text</code> - whether our post will include a spoiler/content warning</li> <li> <code class="language-plaintext highlighter-rouge">language</code> - will be default the language set in our profile (in our case, <code class="language-plaintext highlighter-rouge">en</code>), but I plan to include multi-language posts in the future</li> </ul> <p>We can safely ignore the remaining attributes. To write our small “Hello World!” message, we need to simply input the following:</p> <p><code class="language-plaintext highlighter-rouge">Mastodon.status_post("Hello World!")</code></p> <p>The final program looks like this:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from mastodon import Mastodon
# Setting up Mastodon
mastodon = Mastodon(
  access_token='[ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789]', # this is your access token from the Development tab from the step before
  api_base_url='botsin.space' # this is the URL of your bot's server
)'
# Write a "Hello World!" post
mastodon.status_post("Hello World!")
</code></pre></div></div> <p>Run the program and see how the post is posted. Congrats on the first step!</p> <h2 id="write-a-post-with-attached-media">write a post with attached media</h2> <p>Let’s now try something more complicated and upload an image. The way <code class="language-plaintext highlighter-rouge">mastodon.py</code> handles media posts is basically an extension to a status post. First, you need to prepare the media you want to attach to a post via <code class="language-plaintext highlighter-rouge">Mastodon.media_post</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mastodon.media_post(media_file, mime_type=None, description=None, focus=None, file_name=None, thumbnail=None, thumbnail_mime_type=None, synchronous=False)
</code></pre></div></div> <p>Then,you attach the media to a post. Simple enough, huh? It is a bit more complicated, though. When you use the code above, you will upload a type of media, which gets then an id, and you need to append this id to a status. (Actually, you get a media dictionary that contains the id.)</p> <p>So let’s give it a try! First, we’ll create an image (<code class="language-plaintext highlighter-rouge">koala.png</code>) to upload in a subfolder called <code class="language-plaintext highlighter-rouge">ìmages</code>. You then need to prepare your image and then post it.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>os.chdir("images") # changes the working directory to /images. If you don't want that, simply skip this and store your python script in the same folder as the images.
image = mastodon.media_post("koala.png", # this is the only required argument. you can either give the filename directly or use the "media_file" argument.
                            mime_type ="image/png", # this indicates the filetype. only necessarily needed if you did not use "media_type", otherwise the program will guess the correct file type
                            description ="An image of a koala in a tree!" # adds alt text. you should definitely consider this!
                            )

# Write a "Hello World!" post with an image
mastodon.status_post("Hello world!", # this is the text associated with the message
                      media_ids=image["id"], # as said earlier, the media_post function uploads the image with an id as a dictionary. this calls the correct photo
                      )
</code></pre></div></div> <p>This should display a post like this:</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/2024-07-08-mastobot-tutorial-480.webp 480w,/assets/img/2024-07-08-mastobot-tutorial-800.webp 800w,/assets/img/2024-07-08-mastobot-tutorial-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/2024-07-08-mastobot-tutorial.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Congratulations, you have written the basis for automated Mastodon posts!</p> <h2 id="posting-randomly-one-or-multiple-images">posting randomly one or multiple images</h2> <p>Now we can post images directly from our python console to Mastodon, which is pretty cool, but not yet what we want. Let’s recap, our bot should fulfill the following criteria:</p> <ul> <li>The post consists of 1-4 pictures and a text section.</li> <li>Each picture should have alt text.</li> <li>Since some pictures depict violence/blood or have sexual overtones, so I’d like to be able turn on content warnings and/or toggle visibility of images if needed.</li> </ul> <p>I tackled the first problem and the other two separately. Let’s start with alt text and the sensitivity warning!</p> <h3 id="automatically-adding-alt-text">automatically adding alt text</h3> <p>Adding alt text is important. Even if it’s only “a picture of a black cat”, it helps visually impaired people a lot. I don’t know if this is the best way to do it, but I decided to store alt text (and other metadata like sensitivity or spoiler tags) in a separate file. For whatever reason, I did it in YAML format; probably because it’s easier to manually edit than a CSV or TXT file., maybe because I’ve seen it in another tutorial, who knows.</p> <p>So let’s say we have an image called <code class="language-plaintext highlighter-rouge">imagename.png</code> in the subfolder <code class="language-plaintext highlighter-rouge">images</code>. Then, within the subfolder, we create a subfolder <code class="language-plaintext highlighter-rouge">descriptions</code> (so <code class="language-plaintext highlighter-rouge">/images/descriptions</code>), where we’ll store all our files. In this case, we create a file called <code class="language-plaintext highlighter-rouge">imagename.yml</code> with the following content:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>status: [text] # this is the text to be shown in the posting.
spoiler_warning:  # if not left blank, this will be spoiler tag shown
description: [alt text] # this is the alt text
language: # we will set the default language in the bot script later, but if you want to post images in different languages, you can manually set them here
sensitivity: # if set to True, the image will be blurred. If left blank or set to False, the post will be shown normally
</code></pre></div></div> <p>This you have to do for every single image. I actually created a small python script that automatically detects image files and creates a rudimentary description file for each of them to speed up the process.</p> <p>And that’s it! This way you created a file that will be read out in the next step when posting an image.</p> <h3 id="file-and-folder-structure">file and folder structure</h3> <p>Before coming to the end, let’s quickly go through the folder structure and nomenclature of files! This is what it looks like.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root
  - images
    - descriptions
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">root</code> contains <code class="language-plaintext highlighter-rouge">run.py</code> which is the script in the next section.</p> <p><code class="language-plaintext highlighter-rouge">images</code> contains all of the images your bot wants to post. It can have any nomenclature you want, but do not end the filename with a number! Why? As outlined earlier, the goal is to be able to post multiple pictures. In my case, these belong together, so sometimes a post has two, sometimes four, sometimes only one picture - but they belong together as a group. To make this easier, I added the numbers from 1-4 in the end of the filename if it’s part of such a group. If only a single image is posted, the filename does not end with a number. So it looks like the following:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>imageA.png # this is an image that will be posted alone in a post
imageB-1.png
imageB-2.png # these two images will be posted in the same post. The order of them in the post will be imageB-1.png followed by imageB-1.png
imageC.png # again a single image
imageD-1.png
imageD-2.png
imageD-3.png
imageD-4.png # a group of four images
</code></pre></div></div> <p>I hope you get the idea. Please don’t forget that the maximum number of images per post on Mastodon is four.</p> <p><code class="language-plaintext highlighter-rouge">descriptions</code> contains the YAML files of the images. Each YAML file has the same filename (without file extension) as the image. So <code class="language-plaintext highlighter-rouge">imageD-1.png</code> has a description file named <code class="language-plaintext highlighter-rouge">imageD-1.yml</code>. Every single image needs a separate description file, because the description files contain the alt text of each image.</p> <h3 id="selecting-one-or-multiple-images-and-post-them-on-mastodonpy">selecting one or multiple images and post them on mastodonpy</h3> <p>Now we can finally assemble everything and create the code! We need these modules.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>from mastodon import Mastodon
from pathlib import Path
import os
import random
import yaml
</code></pre></div></div> <p>Some of them we already know; <code class="language-plaintext highlighter-rouge">random</code> is needed to select a random picture and <code class="language-plaintext highlighter-rouge">yaml</code> is needed to read out the YAML files.</p> <p>Then we configure our Mastodon access, as usual.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Access Mastodon instance
mastodon = Mastodon(
    access_token=os.environ['MASTODON_ACCESS_TOKEN'],
    api_base_url='botsin.space'
)
</code></pre></div></div> <p>I will emphasize again that you should check your server’s rules <strong><em>before</em></strong> creating the bot. Many servers don’t allow bots. Even botsin.space only allows a (public) post every six hours.</p> <p>Next, we define two functions which will be used in the final script. The first function will prepare our media file to be posted.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Function to prepare media with image descriptions etc.
def media_description(media): # media is the image name
    description_file = open("images/descriptions/" + media + ".yml", "r") # reads the corresponding YAML description file ...
    description = yaml.load(description_file, Loader=yaml.FullLoader) # ... and sets the description variable with its contents
    alt_text = description["description"] # reads the description part of the YAML file
    # so the next part might be superfluous if you only have one file format and/or trust the automatic file extension detection. Basically, I use the following to see whether the image is a gif, jpeg or png.
    os.chdir("images")  
    filename = media + file_extension
    if file_extension == ".png":
        file_format = "image/png"
    elif file_extension == ".jpeg":
        file_format = "image/jpeg"
    elif file_extension == ".gif":
        file_format = "image/gif"
    post = mastodon.media_post(filename, file_format, description=alt_text) # this creates the media for upload
    media_list.append(post["id"]) # this generates a list. Important because we want sometimes to upload multiple images in one post!
    os.chdir("..") # returns to the parent folder
</code></pre></div></div> <p>The second function will actually create the post.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Function to post status with image
def post_status_with_image(name, spoiler_warning="False", status="#suikoden", sensitivity="False", language="en"): # this sets some default settings which are overriden by the YAML file if not empty
    description_file = open("images/descriptions/" + name + ".yml", "r") # as above, loads the description YAML file
    description = yaml.load(description_file, Loader=yaml.FullLoader)
    status = description["status"]  # reads the status part of the YAML file. This is the text part of the post. I use it for hashtags etc.
    spoiler_warning = description["spoiler_warning"] # content warning and if yes, what?
    language = description["language"] # only needed if your language differs from the default
    sensitivity = description["sensitivity"] # by default False
    mastodon.status_post(status, media_ids=media_list, spoiler_text=spoiler_warning, sensitive=sensitivity,
                         language=language) # creates the post and adds all media from the media list
</code></pre></div></div> <p>Probably, there is a more elegant solution, but this one works so it is good by my standards.</p> <p>Now the actual part of the script:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Choose a random photo out of the /images folder
photo = random.choice([x for x in os.listdir("images") if os.path.isfile(os.path.join("images", x))])

# Get name of photo without ending
name = Path("images/" + photo).stem

# the only reason this is here is to identify errors later when the script is running. Sometimes, your YAML file might be incorrectly filled out, or it's missing altogether. This will help in identifying errors later on!
print(name)

# Get file format of photo
file_extension = Path(photo).suffix

# Create an empty list for all the photos/media we want to add
media_list = [] # This is important when you want to add multiple images in one post. If you only have one photo always, you can keep this, but you can also try to cut it from the code.

# Check if photo is part of a series
if name[-1].isdigit():  # this checks if the last letter of the filename is a number or not.
    # Get both images
    name_1 = name[:-1] + "1"
    name_2 = name[:-1] + "2" # this checks for the image whose name ends with a 2
    name_list = [name_1, name_2] # this creates a list with both images
    # check if image 3 and 4 exist and add to list
    if os.path.exists("images/" + name[:-1] + "3.png"): # checks if there is a third image
        name_3 = name[:-1] + "3"
        name_list.append(name_3) # appends to the list
        if os.path.exists("images/" + name[:-1] + "4.png"): # and finally whether there is a fourth image
            name_4 = name[:-1] + "4"
            name_list.append(name_4) # and also appends it
    for x in name_list:
        media_description(x) # this creates the media description for each image in the list
else:   # in case it does not end with a digit, which means it is not part of a group
    # Get details of post
    media_description(name) # creates the media description for the image

# Post a new status update
post_status_with_image(name) #posts the image to Mastodon
</code></pre></div></div> <p>Done! You have successfully written a script that randomly selects an image, checks whether it is part of a group, creates the alt text and description based on a description file, and uploads it to Mastodon!</p> <p>I know that there are some faults here. Because it first randomly selects an image and then checks whether it is part of a group, groups will be posted more often than single images, and larger groups more often than smaller groups. In order to have the same chance for every group of images, you’d need to eliminate duplicates first. Honestly, this is too much work for what my bot is supposed to do, so i don’t care for now, but might update it in the future!</p> <h2 id="autoposting-at-selected-timepoints">autoposting at selected timepoints</h2> <p>Obviously, you do not want to trigger the code manually each day (even though there is nothing stopping you to do so). In order to automate it, I uploaded the entire thing to github and trigger the code with a github action. As said earlier, I guess this violates their ToS, but well, it is what it is.</p> <p>After you uploaded your entire folder structure to github, create a new folder called <code class="language-plaintext highlighter-rouge">.github/workflows</code> and a file <code class="language-plaintext highlighter-rouge">github-actions.yml</code>. Probably you could also give it a more illustrous name, but it doesn’t matter. The file should contain the following:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>name: [name] # name of your process.

on:
  schedule:
    - cron: 08 01 * * * # this is the time when the script is executed. In this case, it is executed every day at 01:08 am. You can create your cron code here: https://crontab.guru/

jobs:
  TriggerMastobot:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Setup Python  # this tells the bot to use python to execute the file
        uses: actions/setup-python@v4.7.0
        with:
          # Version range or exact version of Python or PyPy to use, using SemVer's version range syntax. Reads from .python-version if unset.
          python-version: 3.10.12
      - name: Install Dependencies  # you need to install these dependencies
        run: |
          pip3 install Mastodon.py  
          pip3 install pyyaml
      - uses: actions/checkout@v2
      - name: run.py  # runs the python script. If you changed the name, change it here as well.
        env:
          MASTODON_ACCESS_TOKEN: $ # USE THIS LIKE THIS! Explanation below
        run: python run.py
      - uses: gautamkrishnar/keepalive-workflow@v1 # using the workflow with default settings
</code></pre></div></div> <p>Now you might wonder - what’s this <code class="language-plaintext highlighter-rouge">$</code>? As written earlier, the API token for your Mastodon should not be shared with anyone - ever. But if you put it on github, it is visible by, well, everyone! So you use this placeholder in the code instead. Then, in your github, go to <code class="language-plaintext highlighter-rouge">Settings &gt; Secrets and variables &gt; Actions</code> and create a new repository token <code class="language-plaintext highlighter-rouge">MASTODON_ACCESS_TOKEN</code> with your Mastodon access token. Now github will magically use this token whenever it runs the code without showing it to anyone. Sweet!</p> <p>Now, your code will be executed at the designated timepoints.</p> <h1 id="the-end">The end</h1> <p>I hope this post was helpful to you if you, as myself, have no idea what you’re doing whatsoever. This was a fun little project, which was actually pretty easy once I understood the logic behind the Mastodon posts.</p> <p>I am not yet completely happy with my code. For instance, I want to add the functionality to post certain pictures only on certain dates (like a Halloween picture only on October 31), but have not found an elegant way to do it yet. Also, the code is probably redundant at some points and could benefit from a critical review.</p> <p>I appreciate any feedback on this post whatsoever! Whether you found it helpful, did not understand some parts because of my bad explanation, or have ideas for improvement, I’d be happy to read your comments!</p> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/"></d-bibliography> <div id="giscus_thread" style="max-width: 930px; margin: 0 auto;"> <script>let giscusTheme=determineComputedTheme(),giscusAttributes={src:"https://giscus.app/client.js","data-repo":"buerviper/buerviper.github.io","data-repo-id":"","data-category":"","data-category-id":"","data-mapping":"","data-strict":"1","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"bottom","data-theme":giscusTheme,"data-lang":"en",crossorigin:"anonymous",async:""},giscusScript=document.createElement("script");Object.entries(giscusAttributes).forEach(([t,e])=>giscusScript.setAttribute(t,e)),document.getElementById("giscus_thread").appendChild(giscusScript);</script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Mathias Micheel. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. <a href="https://buerviper.github.io/legalnote/">Impressum</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order. generated by jekyll-scholar.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-projects",title:"projects",description:"A growing collection of your cool projects.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-cv",title:"cv",description:"With over a decade of professional experience in laser-material interaction and a PhD in the border area of chemistry and physics, I find solutions to find sustainable energy solutions. I have proven my communication and organisational skills in numerous international and interdisciplinary research collaborations and voluntary work. I have gained relevant experience in the planning and realisation of projects and the presentation of project results at conferences and in publications. I take the lead in solving challenges together as a team.",section:"Navigation",handler:()=>{window.location.href="/cv/"}},{id:"dropdown-publications",title:"publications",description:"",section:"Dropdown",handler:()=>{window.location.href=""}},{id:"dropdown-projects",title:"projects",description:"",section:"Dropdown",handler:()=>{window.location.href=""}},{id:"dropdown-blog",title:"blog",description:"",section:"Dropdown",handler:()=>{window.location.href="/blog/"}},{id:"post-how-to-write-a-mastodon-bot-that-posts-random-images-in-python",title:"How to write a Mastodon bot that posts random images in Python",description:"Instructions for dummies from a dummy.",section:"Posts",handler:()=>{window.location.href="/blog/2024/writing-a-mastodon-bot-in-python/"}},{id:"post-bedingungen-f\xfcr-juniorprofessuren-nach-bundesland",title:"Bedingungen f\xfcr Juniorprofessuren nach Bundesland",description:"Eine \xdcbersicht \xfcber Einstellungsvorraussetzungen f\xfcr Juniorprofessuren.",section:"Posts",handler:()=>{window.location.href="/blog/2023/juniorprofessuren/"}},{id:"post-fight-magic-items-by-aidan-moher",title:"Fight, Magic, Items by Aidan Moher",description:"This history of the JRPG genre unfortunately falls short for many reasons.",section:"Posts",handler:()=>{window.location.href="/blog/2023/fight-magic-items/"}},{id:"post-the-myth-of-cancel-culture-in-chemistry-and-science",title:"The Myth of Cancel Culture in Chemistry (and Science)",description:"I actually hoped I&#39;d never have to criticize a Nachrichten aus der Chemie article again, but here we are again.",section:"Posts",handler:()=>{window.location.href="/blog/2022/myth-of-cancel-culture/"}},{id:"post-antrag-gegen-geschlechtergerechte-sprache-auf-der-kommenden-gdch-mitgliederversammlung",title:"Antrag gegen geschlechtergerechte Sprache auf der kommenden GDCh-Mitgliederversammlung",description:"",section:"Posts",handler:()=>{window.location.href="/blog/2021/vorlage-gdch-mitgliederbefragung/"}},{id:"news-i-updated-the-publication-list-to-include-whether-an-article-is-open-access-or-not-hopefully-many-more-to-come",title:"I updated the publication list to include whether an article is Open Access...",description:"",section:"News"},{id:"news-my-rebuttal-https-buerviper-github-io-blog-2022-myth-of-cancel-culture-to-the-krylov-et-al-article-about-cancel-culture-in-chemistry-https-onlinelibrary-wiley-com-doi-10-1002-nadc-20224120702-has-been-published-on-the-gdch-app-https-gdch-app-article-the-myth-of-cancel-culture-in-chemistry-and-science-as-well",title:"My [rebuttal](https://buerviper.github.io/blog/2022/myth-of-cancel-culture/) to the [Krylov *et al.* article about Cancel Culture in Chemistry](https://onlinelibrary.wiley.com/doi/10.1002/nadc.20224120702)...",description:"",section:"News"},{id:"news-new-preprint-https-doi-org-10-26434-chemrxiv-2022-n5wb1-on-chemrxiv-we-directly-functionalized-thin-cdse-quantum-dot-films-with-mlecular-hydrogenase-mimics-and-provided-in-depth-characterization-of-the-functionalization-and-catalytic-activity-great-collaboration-between-leibniz-ipht-uni-jena-and-uni-ulm",title:"[New preprint](https://doi.org/10.26434/chemrxiv-2022-n5wb1) on ChemRxiv! We directly functionalized thin CdSe quantum dot films with...",description:"",section:"News"},{id:"news-i-have-been-elected-ypc-chairperson",title:"I have been elected yPC chairperson!",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_20220909/"}},{id:"news-our-review-https-doi-org-10-1002-admi-202201039-quot-assembly-properties-and-application-of-ordered-group-ii-vi-and-iv-vi-colloidal-semiconductor-nanoparticle-films-quot-has-been-published-in-advanced-materials-interfaces-we-39-re-also-thrilled-to-contribute-the-inner-back-cover-picture-for-the-october-edition",title:"[Our review](https://doi.org/10.1002/admi.202201039) &amp;quot;Assembly, Properties, and Application of Ordered Group II\u2013VI and IV\u2013VI Colloidal...",description:"",section:"News"},{id:"news-a-good-thing-39-s-worth-waiting-for-new-paper-in-jcp",title:"A good thing&amp;#39;s worth waiting for - new paper in JCP!",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_20230416/"}},{id:"news-starting-today-i-39-ll-be-working-as-a-postdoc-at-rptu-kaiserslautern-landau-yeah",title:"Starting today, I&amp;#39;ll be working as a postdoc at RPTU Kaiserslautern-Landau. Yeah!",description:"",section:"News"},{id:"news-today-i-joined-the-work-group-of-dr-sebastian-engel-at-the-institute-of-technical-and-environmental-chemistry-friedrich-schiller-university-jena-where-i-will-explore-new-hybrid-semiconductor-nanomaterials-for-photocatalysis-funded-by-bmbf",title:"Today I joined the work group of Dr. Sebastian Engel at the Institute...",description:"",section:"News"},{id:"news-new-paper-in-acs-appl-nano-mater-on-polydopamine-coated-nanorods",title:"New paper in ACS Appl. Nano Mater. on polydopamine-coated nanorods",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_20240625/"}},{id:"projects-jrpg-history",title:"JRPG History",description:"Until I find time to actually talk about my projects in more detail, enjoy some amazing lorem ipsums here!",section:"Projects",handler:()=>{window.location.href="/jrpg-history/"}},{id:"projects-vorzeit",title:"vorzeit",description:"Die Urspr\xfcnge japanischer Rollenspiele.",section:"Projects",handler:()=>{window.location.href="/vorzeit/"}},{id:"projects-tabletoprollenspiele-in-japan",title:"Tabletoprollenspiele in Japan",description:"Wie das Rollenspiel erst auf die Welt und dann nach Japan kam.",section:"Projects",handler:()=>{window.location.href="/projects/1-Tapletop-Rollenspiele/"}},{id:"projects-goldenes-zeitalter",title:"Goldenes Zeitalter",description:"Als die Pixel k\xe4mpfen lernten.",section:"Projects",handler:()=>{window.location.href="/golden-age/"}},{id:"projects-phantasy-star",title:"Phantasy Star",description:"Wie das Rollenspiel erst auf die Welt und dann nach Japan kam.",section:"Projects",handler:()=>{window.location.href="/projects/1989-phantasy-star/"}},{id:"projects-silbernes-zeitalter",title:"Silbernes Zeitalter",description:"Als die Pixel k\xe4mpfen lernten.",section:"Projects",handler:()=>{window.location.href="/silver-age/"}},{id:"projects-bronzenes-zeitalter",title:"Bronzenes Zeitalter",description:"Als die Pixel k\xe4mpfen lernten.",section:"Projects",handler:()=>{window.location.href="/bronze-age/"}},{id:"projects-post-moderne",title:"(Post-)Moderne",description:"Als die Pixel k\xe4mpfen lernten.",section:"Projects",handler:()=>{window.location.href="/modern-times/"}},{id:"projects-self-healing-polymers",title:"Self-Healing Polymers",description:"during my PhD, I investigated the optical properties and energy transfer processes of self-healing polymers",section:"Projects",handler:()=>{window.location.href="/projects/self-healing/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%6D%61%74%68%69%61%73.%6D%69%63%68%65%65%6C@%75%6E%69-%6A%65%6E%61.%64%65","_blank")}},{id:"socials-orcid",title:"ORCID",section:"Socials",handler:()=>{window.open("https://orcid.org/0000-0002-5017-3511","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=GikPVggAAAAJ","_blank")}},{id:"socials-publons",title:"Publons",section:"Socials",handler:()=>{window.open("https://publons.com/a/1612710/","_blank")}},{id:"socials-mastodon",title:"Mastodon",section:"Socials",handler:()=>{window.open("https://physchem.science/@buerviper","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>